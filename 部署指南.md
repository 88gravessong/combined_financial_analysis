# 🚀 财务数据分析系统 - 容器化部署指南

## 📋 目录
- [本地测试](#本地测试)
- [云服务器部署](#云服务器部署)
- [云容器服务部署](#云容器服务部署)
- [监控和维护](#监控和维护)
- [故障排除](#故障排除)

## 🧪 本地测试

### 1. 构建和运行容器

```bash
# 构建Docker镜像
docker build -t financial-analysis .

# 运行容器（简单模式）
docker run -p 8080:8080 financial-analysis

# 或者使用Docker Compose（推荐）
docker-compose up --build
```

### 2. 访问应用
- 打开浏览器访问: http://localhost:8080
- 测试文件上传和分析功能

### 3. 生产模式测试（带Nginx）
```bash
# 启动包含Nginx的完整环境
docker-compose --profile production up --build
```

## 🌐 云服务器部署

### 方案1: 阿里云ECS + Docker

#### 1. 购买云服务器
- **推荐配置**: 2核4G内存，40G SSD
- **操作系统**: Ubuntu 20.04 LTS
- **网络**: 公网IP，开放80和443端口

#### 2. 服务器初始化
```bash
# 连接到服务器
ssh root@your-server-ip

# 更新系统
apt update && apt upgrade -y

# 安装Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh

# 安装Docker Compose
curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose

# 启动Docker服务
systemctl start docker
systemctl enable docker
```

#### 3. 部署应用
```bash
# 克隆项目
git clone https://github.com/88gravessong/combined_financial_analysis.git
cd combined_financial_analysis

# 生产环境部署
docker-compose --profile production up -d --build

# 查看运行状态
docker-compose ps
```

### 方案2: 腾讯云轻量应用服务器

#### 1. 一键部署脚本
```bash
#!/bin/bash
# 保存为 deploy.sh

echo "🚀 开始部署财务分析系统..."

# 安装Docker
curl -fsSL https://get.docker.com | sh
systemctl start docker
systemctl enable docker

# 克隆代码
git clone https://github.com/88gravessong/combined_financial_analysis.git
cd combined_financial_analysis

# 启动服务
docker-compose up -d --build

echo "✅ 部署完成！"
echo "📊 访问地址: http://$(curl -s ifconfig.me):8080"
```

## ☁️ 云容器服务部署

### 阿里云容器服务ACK

#### 1. 创建Kubernetes配置
```yaml
# k8s-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: financial-analysis
  labels:
    app: financial-analysis
spec:
  replicas: 2
  selector:
    matchLabels:
      app: financial-analysis
  template:
    metadata:
      labels:
        app: financial-analysis
    spec:
      containers:
      - name: financial-analysis
        image: your-registry/financial-analysis:latest
        ports:
        - containerPort: 8080
        resources:
          limits:
            memory: "1Gi"
            cpu: "500m"
          requests:
            memory: "512Mi"
            cpu: "250m"
---
apiVersion: v1
kind: Service
metadata:
  name: financial-analysis-service
spec:
  selector:
    app: financial-analysis
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8080
  type: LoadBalancer
```

#### 2. 部署到ACK
```bash
# 构建并推送镜像到阿里云容器镜像服务
docker build -t registry.cn-hangzhou.aliyuncs.com/your-namespace/financial-analysis:latest .
docker push registry.cn-hangzhou.aliyuncs.com/your-namespace/financial-analysis:latest

# 部署到K8s
kubectl apply -f k8s-deployment.yaml
```

### 腾讯云容器服务TKE

#### 1. 使用腾讯云控制台
- 创建TKE集群
- 通过控制台导入Docker镜像
- 配置负载均衡和自动扩缩容

## 📊 监控和维护

### 1. 健康检查
```bash
# 检查容器状态
docker-compose ps

# 查看日志
docker-compose logs -f financial-analysis

# 重启服务
docker-compose restart
```

### 2. 性能监控
```bash
# 查看资源使用情况
docker stats

# 查看应用日志
docker-compose logs --tail=100 financial-analysis
```

### 3. 备份和更新
```bash
# 更新应用
git pull origin main
docker-compose down
docker-compose up --build -d

# 清理旧镜像
docker image prune -f
```

## 🔧 故障排除

### 常见问题

1. **端口被占用**
   ```bash
   # 查看端口占用
   netstat -tulpn | grep :8080
   # 修改docker-compose.yml中的端口映射
   ```

2. **内存不足**
   ```bash
   # 增加交换空间
   fallocate -l 2G /swapfile
   chmod 600 /swapfile
   mkswap /swapfile
   swapon /swapfile
   ```

3. **文件上传失败**
   - 检查`client_max_body_size`设置
   - 确认磁盘空间充足

### 日志查看
```bash
# 实时查看应用日志
docker-compose logs -f

# 查看特定服务日志
docker-compose logs financial-analysis
```

## 💰 成本估算

### 云服务器方案
- **阿里云ECS**: 2核4G约200-300元/月
- **腾讯云轻量**: 2核4G约100-200元/月
- **华为云ECS**: 2核4G约150-250元/月

### 容器服务方案
- **阿里云ACK**: 约500-800元/月
- **腾讯云TKE**: 约400-700元/月

## 🎯 推荐部署顺序

1. **本地测试** ✅
2. **云服务器部署** (推荐新手)
3. **容器服务部署** (推荐企业用户)
4. **监控配置**
5. **域名和SSL证书配置**

## 📞 技术支持

如遇到问题，请检查：
1. Docker和Docker Compose版本
2. 防火墙设置
3. 服务器资源使用情况
4. 应用日志输出 