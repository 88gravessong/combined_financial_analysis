# 💰 财务数据分析系统

一个基于Web的财务数据分析系统，支持多文件上传和自动化财务指标计算。

## ✨ 功能特点

- 🔗 **多文件支持**: 支持上传多个订单表和结算表文件进行合并分析
- 📊 **拖拽上传**: 现代化的拖拽式文件上传界面
- 🚀 **一键分析**: 自动化财务指标计算和报告生成
- 📈 **详细报告**: 生成包含多个工作表的Excel分析报告
- 🎨 **美观界面**: 响应式设计，支持移动设备

## 📁 文件结构

```
├── app.py              # Flask Web服务器
├── analysis_multi.py   # 多文件分析引擎  
├── analysis.py         # 原始单文件分析脚本
├── index.html          # Web前端页面
├── requirements.txt    # 项目依赖
└── README.md          # 项目说明
```

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

如果遇到SSL证书问题，可使用：
```bash
pip install --trusted-host pypi.org --trusted-host pypi.python.org --trusted-host files.pythonhosted.org -r requirements.txt
```

### 2. 启动服务

```bash
uvicorn fastapi_app:app --host 0.0.0.0 --port 8080
```

### 3. 访问系统

打开浏览器访问：`http://localhost:8080`

## 📊 使用说明

### 文件要求

1. **订单表** (支持多个文件)
   - Excel格式 (.xlsx, .xls)
   - 必须包含：订单ID、SKU、数量、是否出库、平台状态等列

2. **结算表** (支持多个文件)
   - Excel格式 (.xlsx, .xls)  
   - 必须包含：订单ID、结算金额等列

3. **产品成本消耗表** (单个文件)
   - Excel格式 (.xlsx, .xls)
   - 必须包含：SKU、印尼盾ads消耗、印尼盾gmvmax消耗、印尼盾单sku成本等列

### 操作步骤

1. **上传文件**: 在网页中拖拽或点击选择文件
2. **检查文件**: 确认所有三类文件都已上传
3. **开始分析**: 点击"🚀 开始分析"按钮
4. **下载结果**: 分析完成后下载Excel报告

## 📈 输出报告

分析完成后将生成包含以下工作表的Excel文件：

- **订单表_含结算与操作费**: 原始订单数据加上计算字段
- **sku汇总_结算与操作费**: SKU级别的汇总数据  
- **排除订单_多行结算**: 被排除的重复结算订单
- **sku财务指标**: 详细的SKU级别财务指标分析

## 💡 技术特点

- **后端**: Flask + pandas + openpyxl
- **前端**: 原生HTML/CSS/JavaScript，响应式设计
- **文件处理**: 支持多文件合并和临时目录管理
- **错误处理**: 完善的异常处理和用户反馈

## 🔧 配置参数

在 `analysis_multi.py` 中可修改汇率设置：

```python
IDR_PER_RMB, IDR_PER_USD = 2300, 16000  # 印尼盾对人民币和美元汇率
```

## 📝 注意事项

- 确保上传的Excel文件格式正确且包含必要的列
- 系统会自动识别列名，支持中英文列名
- 文件大小限制为100MB
- 处理大量数据时请耐心等待

## 🐛 故障排除

### 常见问题

1. **SSL证书错误**: 使用 `--trusted-host` 参数安装依赖
2. **列名识别失败**: 检查Excel文件中的列名是否包含关键字
3. **内存不足**: 减少上传文件大小或增加系统内存

### 日志查看

Flask服务器会在控制台输出详细的处理日志，包括：
- 文件读取状态
- 数据合并过程  
- 列名识别结果
- 处理统计信息

## 🚀 扩展功能

系统设计为模块化架构，可以轻松扩展：

- 添加新的数据源类型
- 增加更多财务指标计算
- 支持其他文件格式 (CSV, JSON等)
- 集成数据库存储
- 添加用户认证和权限管理

---

**开发者**: 自动算利润团队  
**版本**: v1.0  
**更新时间**: 2024年12月 